{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectors"},"hierarchy":{"paths":[["doc:\/\/Kubrick\/documentation\/Kubrick"]]},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/kubrick\/jobdirectors"]}],"kind":"article","metadata":{"modules":[{"name":"Kubrick"}],"roleHeading":"Article","title":"Job Directors","color":{"standardColorIdentifier":"purple"},"role":"article"},"abstract":[{"type":"text","text":"Details of coordination between principal and assistant Directors."}],"sections":[],"schemaVersion":{"major":0,"patch":0,"minor":3},"primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"Overview","anchor":"Overview","type":"heading"},{"inlineContent":[{"text":"Kubrick supports directing the execution of Jobs across coordinated processes allowing Jobs to be started in one","type":"text"},{"type":"text","text":" "},{"text":"process and completed in another. The transfer of Jobs between Directors can be explicit or as a failsafe to complete","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Jobs that don’t complete in their original process."}],"type":"paragraph"},{"level":2,"type":"heading","text":"Modes","anchor":"Modes"},{"inlineContent":[{"text":"Directors operate in two modes “principal” and “assistant”. Principals and assistants work together on the same","type":"text"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobStore"},{"type":"text","text":" to ensure that Jobs execute to completion across process restarts."}],"type":"paragraph"},{"columns":[{"content":[{"inlineContent":[{"type":"text","text":"Principal Directors not only execute the Jobs submitted to it but also watch the Job activity of assistants and"},{"type":"text","text":" "},{"type":"text","text":"will takes control of assistant Jobs when necessary to ensure the Jobs get completed. The design is specifically"},{"type":"text","text":" "},{"text":"targeted at supporting applications and extensions working together, see ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectors#Applications-Extensions"},{"type":"text","text":"."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Each distinct Jobs store supports a single principal Director and as many assistant Directors as necessary."},{"text":" ","type":"text"},{"type":"text","text":"Multiple principal Directors can be ran simultaneously by using separate "},{"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobStore","isActive":true,"type":"reference"},{"type":"text","text":" instances."}]}],"size":2},{"content":[{"inlineContent":[{"identifier":"processes","type":"image"}],"type":"paragraph"}],"size":1}],"type":"row","numberOfColumns":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"To initialize multiple coordinating "},{"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirector","isActive":true,"type":"reference"},{"text":" instances, you pass the same ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorID"},{"text":" and location","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Directory with differing "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode"},{"text":" values.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"In one process we initialize the principal Director using the "},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode\/principal"},{"type":"text","text":" mode:"}]},{"syntax":"swift","code":["let jobStoreLocation = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"com.example.app\")!","let jobDirectorID = JobDirectorID(\"ExampleJobStore\")!","","let jobDirector = try JobDirector(id: jobDirectorID, location: jobStoreLocation, mode: .principal)"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In another process we initialize an assistant Director using the same location and Director"},{"type":"text","text":" "},{"type":"text","text":"ID, using the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode\/assistant(name:)"},{"type":"text","text":" mode with a unique name for the assistant:"}]},{"syntax":"swift","code":["let jobStoreLocation = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"com.example.app\")!","let jobDirectorID = JobDirectorID(\"ExampleJobStore\")!","","let jobDirector = try JobDirector(id: jobDirectorID, location: jobStoreLocation, mode: .assistant(\"Assistant1\"))"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"At this point the principal and the assistant will work together and any Jobs that fail to complete in the assistant"},{"text":" ","type":"text"},{"type":"text","text":"will be completed by the principal Director "},{"inlineContent":[{"type":"text","text":"automatically"}],"type":"strong"},{"type":"text","text":". Additionally, the assistant can choose to transfer"},{"text":" ","type":"text"},{"text":"Jobs to the principal explicitly.","type":"text"}],"type":"paragraph"},{"text":"Job Transfers","level":2,"type":"heading","anchor":"Job-Transfers"},{"inlineContent":[{"type":"text","text":"Job transfers are uni-directional, they only transfer from assistant Directors to the principal Director; they never"},{"text":" ","type":"text"},{"text":"transfer from a principal to an assistant.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Principal Directors automatically transfer Jobs from assistants when the assistant is stopped or its processes exits."},{"text":" ","type":"text"},{"type":"text","text":"The is a failsafe to ensure long running Jobs in assistants are always processed to completion. There is nothing"},{"text":" ","type":"text"},{"type":"text","text":"special required to enable automatic transfers except to start the principal Director on process startup."}]},{"type":"heading","anchor":"Explicit-Job-transfers","text":"Explicit Job transfers","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Additionally, Jobs can be explicitly transferred to the principal Director by the assistant a Job is executing in. This"},{"type":"text","text":" "},{"type":"text","text":"supports scenarios like starting Jobs that include background "},{"code":"URLSession","type":"codeVoice"},{"text":" transfers in an assistant and completing","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the Job in the principal Director, reusing the same Job definitions throughout."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To explicitly transfer a Job, the "},{"inlineContent":[{"text":"Job","type":"text"}],"type":"strong"},{"type":"text","text":" itself must call "},{"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirector\/transferToPrincipal()","isActive":true},{"type":"text","text":". If the Job is"},{"type":"text","text":" "},{"type":"text","text":"currently being executed by an assistant Director, it will be transferred to the principal Director."}]},{"type":"paragraph","inlineContent":[{"text":"The following example shows an explicit transfer to the principal Director after starting a file download.","type":"text"}]},{"type":"codeListing","code":["struct ExampleJob: SubmittableJob, Codable {","  ","  @JobInput var downloadedFile: URL","  ","  @JobEnvironmentValue(\\.currentJobDirector) var director","  ","  init() {","    self.$downloadedFile.bind {","      URLSessionDownloadFileJob()","        .request(URLRequest(url: URL(\"https:\/\/example.com\/some\/file\")))","        .onStart {","          try director.transferToPrincipal()","        }","    }","  }","  ","  func execute() async {","    print(\"Downloaded file URL\", downloadedFile)","  }","  ","}"],"syntax":"swift"},{"type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This example is fairly advanced and uses "},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/URLSessionJobs"},{"text":" that are setup to use a background ","type":"text"},{"type":"codeVoice","code":"URLSession"},{"text":" ","type":"text"},{"text":"and relies on the session being configured to launch the main application to process background session events.","type":"text"}]}],"name":"Note","style":"note"},{"text":"Applications & Extensions","anchor":"Applications--Extensions","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"The primary function of having principal and assistant Directors is to coordinate work between a main application and"},{"text":" ","type":"text"},{"text":"one or more extensions using the same Jobs for all scenarios.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectors#Explicit-Job-transfers","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/URLSessionJobs","isActive":true},{"text":", and ","type":"text"},{"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/UserNotificationJobs","isActive":true,"type":"reference"},{"type":"text","text":" all work together to make working"},{"text":" ","type":"text"},{"text":"with applications and extensions easier.","type":"text"}]}]}],"references":{"doc://Kubrick/documentation/Kubrick/UserNotificationJobs":{"role":"article","abstract":[{"type":"text","text":"Using Jobs for displaying User Notifications and processing their responses."}],"title":"User Notification Jobs","type":"topic","kind":"article","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/UserNotificationJobs","url":"\/documentation\/kubrick\/usernotificationjobs"},"doc://Kubrick/documentation/Kubrick/JobDirector/transferToPrincipal()":{"role":"symbol","abstract":[],"title":"transferToPrincipal()","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"text":"transferToPrincipal","kind":"identifier"},{"kind":"text","text":"() "},{"text":"throws","kind":"keyword"}],"type":"topic","kind":"symbol","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirector\/transferToPrincipal()","url":"\/documentation\/kubrick\/jobdirector\/transfertoprincipal()"},"doc://Kubrick/documentation/Kubrick/JobDirectorMode/principal":{"abstract":[],"type":"topic","title":"JobDirectorMode.principal","fragments":[{"text":"case","kind":"keyword"},{"kind":"text","text":" "},{"text":"principal","kind":"identifier"}],"kind":"symbol","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode\/principal","url":"\/documentation\/kubrick\/jobdirectormode\/principal","role":"symbol"},"doc://Kubrick/documentation/Kubrick/JobDirector":{"fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"JobDirector","kind":"identifier"}],"abstract":[{"type":"text","text":"Directs execution of submitted jobs."}],"title":"JobDirector","role":"symbol","type":"topic","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirector","navigatorTitle":[{"kind":"identifier","text":"JobDirector"}],"kind":"symbol","url":"\/documentation\/kubrick\/jobdirector"},"doc://Kubrick/documentation/Kubrick":{"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick","role":"collection","kind":"symbol","images":[{"identifier":"logo.png","type":"icon"}],"type":"topic","abstract":[{"text":"Director for persistent, resilient, idempotent, asynchronous Jobs built on Swift concurrency.","type":"text"}],"title":"Kubrick","url":"\/documentation\/kubrick"},"logo.png":{"alt":null,"type":"image","identifier":"logo.png","variants":[{"url":"\/images\/logo.png","traits":["1x","light"]},{"traits":["2x","light"],"url":"\/images\/logo@2x.png"}]},"doc://Kubrick/documentation/Kubrick/JobDirectorMode":{"abstract":[],"navigatorTitle":[{"kind":"identifier","text":"JobDirectorMode"}],"type":"topic","title":"JobDirectorMode","fragments":[{"kind":"keyword","text":"enum"},{"text":" ","kind":"text"},{"text":"JobDirectorMode","kind":"identifier"}],"kind":"symbol","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode","url":"\/documentation\/kubrick\/jobdirectormode","role":"symbol"},"doc://Kubrick/documentation/Kubrick/JobStore":{"title":"Job Store","url":"\/documentation\/kubrick\/jobstore","abstract":[{"type":"text","text":"Details of the "},{"type":"codeVoice","code":"job-store"},{"type":"text","text":" format used to save\/restore Job state."}],"kind":"article","role":"article","type":"topic","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobStore"},"processes":{"alt":"Diagram of principal and assistant directors working together","identifier":"processes","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/processes.png"},{"url":"\/images\/processes@2x.png","traits":["2x","light"]},{"traits":["3x","light"],"url":"\/images\/processes@3x.png"}]},"doc://Kubrick/documentation/Kubrick/JobDirectors#Applications-Extensions":{"url":"\/documentation\/kubrick\/jobdirectors#Applications-Extensions","abstract":[],"kind":"section","type":"topic","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectors#Applications-Extensions","title":"Applications & Extensions"},"doc://Kubrick/documentation/Kubrick/JobDirectorMode/assistant(name:)":{"kind":"symbol","title":"JobDirectorMode.assistant(name:)","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorMode\/assistant(name:)","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"text":"assistant","kind":"identifier"},{"text":"(","kind":"text"},{"kind":"externalParam","text":"name"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"text":")","kind":"text"}],"url":"\/documentation\/kubrick\/jobdirectormode\/assistant(name:)","abstract":[],"role":"symbol","type":"topic"},"doc://Kubrick/documentation/Kubrick/URLSessionJobs":{"url":"\/documentation\/kubrick\/urlsessionjobs","role":"article","type":"topic","title":"URLSession Jobs","kind":"article","abstract":[{"type":"text","text":"Details on setting up and using URL Session download & upload transfers in Jobs."}],"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/URLSessionJobs"},"doc://Kubrick/documentation/Kubrick/JobDirectors#Explicit-Job-transfers":{"url":"\/documentation\/kubrick\/jobdirectors#Explicit-Job-transfers","abstract":[],"kind":"section","type":"topic","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectors#Explicit-Job-transfers","title":"Explicit Job transfers"},"doc://Kubrick/documentation/Kubrick/JobDirectorID":{"url":"\/documentation\/kubrick\/jobdirectorid","abstract":[{"type":"text","text":"Identifier for a "},{"isActive":true,"type":"reference","identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirector"},{"text":".","type":"text"}],"identifier":"doc:\/\/Kubrick\/documentation\/Kubrick\/JobDirectorID","role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"JobDirectorID"}],"navigatorTitle":[{"kind":"identifier","text":"JobDirectorID"}],"kind":"symbol","type":"topic","title":"JobDirectorID"}}}